apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: trains
  namespace: trains
spec:
  interval: 5m
  releaseName: trains
  chart:
    spec:
      chart: ./trains-server-chart
      sourceRef:
        kind: GitRepository
        name: valeriano-manassero-trains
        namespace: flux-system
      interval: 1m
  values:
    trains:
      nodeSelector: "app: trains"
    agent:
      agentVersion: "0.16.2rc0"
      agentVersionComparisonOperator: "=="
      queues: "default"
      dockerMode: false
      numberOfTrainsAgents: 1
      nvidiaGpusPerAgent: 1
      defaultBaseDocker: "nvidia/cuda"
      trainsApiHost: "http://trains.namecheapcloud.net:30008"
      trainsWebHost: "http://trains.namecheapcloud.net:30080"
      trainsFilesHost: "http://trains.namecheapcloud.net:30081"
  valuesFrom:
  - secretKeyRef:
      name: trains-configs
      namespace: sealed-secrets
      key: values.yaml
      optional: false
